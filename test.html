<style>
    #switch-main-banner {
        width: 1200px;
        height: 300px;
        overflow: hidden;
        margin: 0 auto;
        position: relative;
        text-align: center;
    }

    #switch-main-banner a {
        display: block;
        height: 300px;
        width: 1200px;
    }

    #switch-main-banner a img {
        height: 300px;
        vertical-align: top;
        display: block;
    }

    #switch-main-banner .ks-switchable-nav {
        position: absolute;
        left: 0;
        width: 100%;
        bottom: 22px;
        height: 0;
        z-index: 10;
        text-align: center;
        display: inline-block;
    }

    #switch-main-banner .ks-switchable-nav li {
        display: inline-block;
        background: url(http://img.sjplus.cn/read/527476ac98bff5641600000f.png) -16px 0 no-repeat;
        width: 11px;
        height: 11px;
        overflow: hidden;
        text-indent: -9999em;
        margin: 0 3px;
    }

    #switch-main-banner .ks-switchable-nav li.ks-active {
        background-position: 0 0;
    }

    /*热门作品和最新作品*/
    .J-design-works {
        margin: 23px auto 16px auto;
        font-size: 12px;
    }

    .J-design-works a {
        margin-right: 12px;
        cursor: pointer;
    }

    .J-design-works a.active {
        font-size: 18px;
    }

    #design-works-container {
        overflow: hidden;
    }

    #design-works-container .control {
        text-align: center;
    }

    #design-works-container .control a {
        margin: 0 8px;
    }

    #design-works-container ul {
        width: 1200px;
    }

    #design-works-container li {
        width: 230px;
        height: 240px;
        position: relative;
        float: left;
        margin-right: 23px;
    }

    #design-works-container li div.describe{
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 175px;
        filter:progid:DXImageTransform.Microsoft.gradient(enabled='true',startColorstr='#CC919287', endColorstr='#CC919287');background:rgba(145,146,135,0.8);
        visibility: hidden;
        overflow: hidden;
        color: #000;
    }

    #design-works-container li a.link{
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height:175px;
        z-index: 3;
    }

    #design-works-container li:hover div.describe{
        visibility: visible;
    }

    #design-works-container li h2{
        font-size: 20px;
        margin: 12px 20px 12px 20px;
        word-break: break-all;
    }

    #design-works-container li p{
        margin: 0 20px;
        word-break: break-all;
    }

    #design-works-container li .avatar {
        position: absolute;
        left: 0;
        top: 180px;
    }

    #design-works-container li .avatar img {
        border-radius: 2px;
    }

    #design-works-container li .info {
        position: absolute;
        right: 0;
        top: 180px;
        color: #999;
    }

    #design-works-container .info {
        font-size: 12px;
        font-family: "华文细黑", verdana
    }

    #design-works-container .data-icon {
        font-size: 14px;
        margin-left: 3px;
        margin-right: 5px;
        display: inline-block;
        vertical-align: middle;
    }
</style>

<div id="switch-main-banner" class="ks-scroll-view">
    <div class="ks-switchable-content">
        #each{group:首屏轮播,title:图片和链接,href:链接:url,img:图片:img,row:10,defaultRow:3,id:1e5a5ed248ab099ae9b3aa9dc58890bc42329f58}
        <a href="#{href}"><img src="#{img}"/></a>
        #end
    </div>
</div>
<script>

    KISSY.use('switchable', function (S, Switchable) {
        new Switchable.Slide('#switch-main-banner', {
            effect: 'fade',
            easing: 'easeOutStrong',
            interval: 3,
            autoPlay: false,
            duration: 1
        });
    });
</script>


<div class="wrapper">
    <div class="wrapper-990" id="design-works-container">
        <div class="tab J-design-works">
            <a class="active J-latest-works">最新作品</a>
            <a class="J-hot-design">热门作品</a>
        </div>
        <div class="J-design-works-container J-unit">
            <div class="list">
                <script type="text/tpl" id="latest-design-works-tpl">
                    @@each(item in data)
                    <li>
                        <div class="describe"><h2>@@{item.title}</h2><p>@@{item.content}</p></div>
                            <img src="@@{imgCDN}/read/@@{item.thumbnails_id}">
                        <a href="@@{hostDOMAIN}/design-works/detail/@@{item._id}" class="link"></a>
                        <div class="avatar">
                            <a href="/u/@@{item.owner_id}"><img src="@@{imgCDN}/avatar/@@{item.owner_id}_20x20"></a>
                        </div>
                        <div class="info">
                            <span class="view"> <b class="data-icon" data-icon="&#xe00a;"></b> @@{item.index.view} </span>
                            <span class="love"> <b class="data-icon" data-icon="&#xe007;"></b> @@{item.index.love} </span>
                            <span class="comment"> <b class="data-icon" data-icon="&#xe015;"></b> @@{item.index.comment} </span>
                        </div>
                    </li>
                    @@end
                </script>
                <ul class="clearfix" id="latest-design-works-wrapper"></ul>
            </div>
            <div class="control">
                <a href="#" class="btn btn-large J-prev-page">上一页</a>
                <a href="#" class="btn btn-large J-next-page">下一页</a>
            </div>
        </div>
        <!--热门作品-->
        <div class="J-hot-design-works-container J-unit">
            <div class="list hide" id="J-design-works-fromid-arr">
                #each{group:最热作品,title:8个最热作品列表,uid:填写作品的ID:string,row:8,defaultRow:8,id:bdad6bf1acc857e5328f91362096fd2a966df69d} #{uid}, #end
            </div>
            <div class="item">
                <ul id="J-design-works-fromid-container"></ul>
            </div>
        </div>
    </div>
</div>

<style>
    #hot-user h2 {
        font-size: 18px;
        margin: 23px auto 12px auto;
    }

    #hot-user ul {
        width: 1014px;
    }

    #hot-user li {
        width: 230px;
        height: 210px;
        position: relative;
        background: #fff;
        float: left;
        margin-right: 23px;
        margin-bottom: 12px;
    }

    #hot-user li a.big-avatar {
        position: absolute;
        left: 5px;
        top: 6px;
    }

    #hot-user li a.big-avatar img {
        border-radius: 2px;
    }

    #hot-user .info {
        top: 12px;
        left: 94px;
        position: absolute;
    }

    #hot-user p.array {
        position: absolute;
        top: 95px;
        left: 5px;
    }

    #hot-user p.array a {
        float: left;
        width: 55px;
        height: 55px;
        background-position: center center;
    }

    #hot-user p.array a img {
        display: block;
        opacity: .8;
    }
</style>
<div class="wrapper">
    <div class="wrapper-990" id="hot-user">
        <div class="title"><h2>狂热份子</h2></div>
        <div class="user-container">
            <div class="item">
                <script type="text/tpl" id="hot-user-arr">
                    #each{group:狂热份子,title:狂热份子,buid:主用户ID(为24个字符):string,id:8c13e60bf9b7b9e826a57beea2b5b9cd2de8079c,row:4,defaultRow:4}#{buid}#end
                </script>
                <script type="text/tpl" id="hot-user-tpl">
                    @@run var info=user.privacy_information
                    <li>
                        <div class="info">
                            <h3>@@{user.user}</h3>
                            <div class="address">
                                @@if(info.address)@@{info.address.value}@@end
                                <b class="data-icon" data-icon="&#xe009;"></b>
                            </div>
                            <div class="jobs">@@if(info.job)@@{info.job.value}@@end</div>
                        </div>
                        <a href="/u/@@{user._id}" class="big-avatar"><img src="@@{imgCDN}/avatar/@@{user._id}_80x80"></a>
                        <p class="array">
                            @@each(item in thumbnails)
                                <a href="@@{hostDOMAIN}/design-works/detail/@@{item._id}" style="background-image:url(@@{imgCDN}/read/@@{item.thumbnails_id})"></a>
                            @@end
                        </p>
                    </li>

                </script>
                <ul class="clearfix" id="hot-user-wrapper"></ul>
            </div>
        </div>

    </div>
</div>

<script>
    KISSY.ready(function (S) {
        seajs.use(['$', 'template'], function ($, template) {
            var tpl = $('#hot-user-tpl').html().replace(/@@/gm, '#')
            var idArr = []
            S.each($('#hot-user-arr').html().split(/[\r\n]/), function (id) {
                if (S.trim(id).length === 24) idArr.push(id)
            });
            //获取最新的作品
            $.ajax({
                        url: hostDOMAIN + '/design-works/hot/list',
                        data: {
                            user: idArr.join(','),
                            count: 8
                        }, dataType: 'jsonp'
                    }
            ).done(function (data) {
                        if (!data.err) {
                            var str = ''
                            S.each(S.keys(data), function (key) {
                                console.log(data[key])
                                str += template.render(tpl, data[key])
                            })
                            $('#hot-user-wrapper').html(str)
                        }
                    }
            )
        })
        seajs.use(['$', 'template'], function ($, template) {
            var tpl = $('#latest-design-works-tpl').html().replace(/@@/gm, '#')
            var page = 1
            var pageNum = 1
            var count = 8
            var sumPage = 0
            function getData() {
                console.log(page)
                $.ajax({
                    url: hostDOMAIN + '/design-works/latest/list',
                    dataType: 'jsonp',
                    data: {
                        page: page,
                        pageNum: pageNum,
                        count: count
                    }
                }).done(function (data) {
                            sumPage = data.sumPage
                            $('#latest-design-works-wrapper').html(template.render(tpl, data))
                        })
            }
            getData()
            $('div.J-design-works-container').on('click', '.J-prev-page,.J-next-page', function (ev) {
                ev.preventDefault()
                var $target = $(ev.currentTarget);
                if ($target.hasClass('J-prev-page')) {
                    page--
                    if (page < 1) page = 1
                }
                if ($target.hasClass('J-next-page')) {
                    if (page < sumPage) page++
                }
                getData()
            })

            //获取热门作品
            function getHotDesignWorks() {
                var arr = 0
                $.ajax({
                    url: hostDOMAIN + '/design-works/fromid/list',
                    dataType: 'jsonp',
                    data: {
                        id_arr: $('#J-design-works-fromid-arr').html().replace(/[\s\r\n]/gmi, '').split(/,/).join(',')
                    }
                }).done(function (data) {
                            console.log(data)
                            $('#J-design-works-fromid-container').html(template.render(tpl, data))
                        })
            }

            var unitArr = $('#design-works-container .J-unit')
            $('div.J-design-works').on('click', 'a', function (ev) {
                var $this = $(this)
                $this.addClass('active').siblings().removeClass('active')
                var index = $('div.J-design-works a').index($this)
                unitArr.hide()
                $(unitArr[index]).show()
                if (!$this.data('is-loading') && $this.hasClass('J-hot-design')) {
                    $this.data('is-loading', true)
                    getHotDesignWorks()
                }
            })
        })
    })
</script>